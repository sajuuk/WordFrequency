<!--
 * @Author: Corvo Attano(fkxzz001@qq.com)
 * @Description: 
 * @LastEditors: Corvo Attano(fkxzz001@qq.com)
-->
# 多线程协调词频统计
* 构建:
```shell
mkdir build
cd build
cmake -DCMAKE_BUILD_TYPE=Release ..
make
```
* 使用:
```shell
./word_count -n [number of thread(s)] -d [dirname]
```
## 数据结构
* 采用stl map数据结构存储词频统计数据，map内部由红黑树实现，可以实现O(logn)的插入和更新
* 每个worker线程维护其自身的map，其任务完成后，进入临界区，将其map结果与全局输出合并
* struct splitRecord记录了每个worker的工作内容，每个worker会处理两种类型的任务：完整文件和分割文件。单个worker可能会处理多个完整文件，最多处理两个分割文件。任务由主线程分割后分发给各worker线程。
## 主线程工作流程
* 遍历目标文件夹及子文件夹，找到.txt文件，保存其路径和大小
* 将文件按大小平均分配到子线程
* 任务分割方法为
* 等待子线程完成统计，输出统计结果。
## 子线程工作流程
* 对于完整文件类型任务，则依次遍历任务列表中的文本，并以map结构存储统计结果。
* 对于分割文件类型任务，统计方法与完整文件类型任务类似，但当分割点在单词内的时候，会导致一个词被分成两个词，为防止这种情况出现，每个工作线程处理文本时，若不是从文件偏移0处开始处理，且偏移量为0的位置是字母，则放弃第一个词。并超前读取其所辖分割区域外的后M字节，假设这个区域为区域2。如果区域2第一个字符为字母，则处理这个区域的第一个单词并将其统计。这样就可以避免分割点在单词内造成的问题。
* 之后进入临界区，将自己维护的map合并到全局map中，退出线程